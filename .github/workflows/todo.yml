name: Create Issues from TODOs

on:
  push:
    branches: ["main"]

permissions:
  issues: write

jobs:
  todos:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Scan for TODOs
        run: |
          # Write grep output to file regardless of exit code, and ensure file exists
          (grep -R "TODO" ./apps ./services ./packages || true) > todos.txt
          # Ensure the file is non-empty for the next step (optional)
          if [ ! -s todos.txt ]; then echo "No TODOs found" > todos.txt; fi
      - name: Create Issues
        uses: peter-evans/create-issue-from-file@v5
        with:
          title: "TODOs found in commit ${{ github.sha }}"
          content-filepath: ./todos.txt
          labels: todo
